name: Run Scraper
on:
  workflow_dispatch: {}
  schedule:
    - cron: "0 11 * * *"
jobs:
  run:
    runs-on: ubuntu-latest
    env:
      GOOGLE_TOKEN: ${{ secrets.GOOGLE_CREDENTIALS }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      # üêç Python: descarga el cuadernillo y lo sube a Drive
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      
      - name: Install Python dependencies
        run: pip install -r requirements.txt
      
      - name: Run scraper
        run: python main.py

      # üü¶ Node: analiza el PDF con Gemini y genera el PDF de salida
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "22"

      - name: Install Node dependencies
        run: npm install

      - name: Run Gemini analysis
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: npm run analyze

      # (Opcional) subir el PDF de an√°lisis como artefacto del workflow
      - name: Upload analysis PDF
        uses: actions/upload-artifact@v4
        with:
          name: analisis-el-peruano
          # Ajusta la ruta seg√∫n donde lo est√© guardando analyze.ts
          path: logs/analisis-*.pdf
